# Simple Matrix Multiplication Implementations

## Python implementation

Generates the test files in NumPy npy and npz format
(see [numpy.lib.format](https://numpy.org/doc/stable/reference/generated/numpy.lib.format.html#module-numpy.lib.format)):
```
matrices.npz
matrix-a.npy
matrix-b.npy
matrix-c.npy
```

The `matrices.npz` file contains 512 triples of matrices $a$, $b$ and $c$.
The $a$ and $b$ matrices have height and width ranging between 2 and 8 in every combination that makes sense to allow $a$ and $b$ to be multiplied together.
The $c$ matrices contain the result of the multiplication $c = a * b$.

A random seed is used to ensure the same matrices are generated each time.

The multiplication operation is then benchmarked by performing each of the multiplications 32768 times in serial.
The tests use 64-bit floating-point arithmetic.

To run the code, ensure NumPy is installed, then call:
```
python3 matmul.py
```

You should see output like the following.
```
Time taken to perform 16777216 multiply operations: 39.92 seconds
Equivalent to 420289.64 operations per second
```

## C implementation

This loads in the files generated by `matmul.py` and uses them for unit tests and benchmarking.
The actual multiplication operation can be found in the [`src/operations.c`](matmul-c/src/operations.c) file.

To build you'll need `make`, `gcc` and the `libarchive` developer libraries installed.
On Ubuntu this can be done as follows.
```
sudo apt install make gcc libarchive-dev 
cd matmul-c
make
```

On macOS this can be done as follows.
```
brew install make gcc libarchive
cd matmul-c
make
```

Then to run the tests and benchmarks on either platform:
```
make test
```

You should see output like the following.
```
Time taken to perform 16777216 multiply operations: 1.44 seconds
Equivalent to 11666383.42 operations per second
```

As with the Python implementation the benchmarks use 64-bit floating-point arithmetic (doubles). 

## Benchmarking Results

The following benchmarking results were obtained using the following devices:

1. 12th Gen Intel Core i7-1260P running Ubuntu 22.04.4, Python 3.10.12 and NumPy 1.25.5.
2. Apple M1 Pro running macOS 13.6.3, Python 3.12.2 and NumPy 1.24.2.
3. Apple M2 (powered), macOS 14.4, Python 3.12.2, numpy 1.26.4

The times taken are to perform 16,777,216 matrix multiply operations.

### Python

| Device       | Python (s) | Python (ops/s) |
|:-------------|-----------:|---------------:|
| Intel i7     |      39.92 |     420,289.64 |
| Apple M1 Pro |      28.70 |     584,562.19 |
| Apple M2     |      29.37 |        571,142 |

### C

| Device       | C (s) |     C (ops/s) |
|:-------------|------:|--------------:|
| Intel i7     |  1.44 | 11,666,383.42 |
| Apple M1 Pro |  1.54 | 10,873,615.05 |
| Apple M2     |  1.02 |    16,525,369 |

### Racket

Naive implementation, boxed floats.

| Device   |     s |   ops/s |
|:---------|------:|--------:|
|          |       |         |
|          |       |         |
| Apple M2 | 39.36 | 426,272 |

